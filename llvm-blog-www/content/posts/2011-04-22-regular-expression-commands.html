---
author: Greg Clayton
blogger_id: tag:blogger.com,1999:blog-6088150582281556517.post-1313926822010330378
blogger_orig_url: http://blog.llvm.org/2011/04/regular-expression-commands.html
date: "2011-04-22T10:19:00Z"
modified_time: "2011-05-20T22:16:33.595-07:00"
tags: ["LLDB"]
title: Regular Expression Commands
---

<span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">  Greetings LLDB users. I want to start writing regular blog posts for the new and cool features and things you can do in LLDB. Today I will start with one that was just added: regular expression commands.</span></span><br /><div><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><br /></span></span><br /><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"></span></span><br /><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><a name='more'></a></span></span><br /><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><br />What is a regular expression command? It is a smart alias to other commands that you can define using the "</span></span><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">command regex" </span></span><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">command. You define a regular expression command by giving it a command name followed by a series of regular expression and substitution pairs. The regular expression and substitution pairs are supplied in a standard stream editor search and replace format:</span></span></div><div><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><br /></span></span></div><div><span class="Apple-tab-span" style="white-space: pre;"><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';"> </span></span></span><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">s/&lt;regex&gt;/&lt;subst&gt;/</span></span></div><div><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><br /></span></span></div><div><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">When a command in later entered, it will strip off the regular expression command name and any spaces that follow, it and pass the raw argument string to be matched against your regular expression list in the order in which they were entered. The first </span></span><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">&lt;regex</span></span><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">&gt;</span></span><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"> to match the raw argument string will then be allowed substitute in </span></span><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">the command defined by </span></span><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><span class="Apple-style-span" style="font-family: 'courier new';">&lt;subst&gt;</span>.</span></span></div><div><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><br /></span></span></div><div><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">Lets supposed we want to use the </span></span><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">"f"</span></span></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"> as a command to select a frame by frame index. The command to select a frame by the frame index is the </span></span><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">"frame select &lt;num&gt;</span></span><frame-idx><num><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">"</span></span></num></frame-idx></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"> command which you might not always want to type out. We can make this a bit easier this using a regular expression command:<br /></span></span><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><br /></span></span></code></div><div><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">(lldb) command regex f 's/([0-9]+)/frame select %1/' </span></span></code></div><div><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><br /></span></span></code></div><div><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">"command regex f"</span></span></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"> tells the interpreter to create a new regex command named </span></span><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">"f"</span></span></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">, and when a command is entered on the command line that starts with </span></span><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">"f"</span></span></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">, it will match the remaining command text against the regular expression </span></span><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">"([0-9]+)"</span></span></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">, and it if matches, it will substitute any parenthesized subexpressions. Here we enclosed the number regular expression </span></span><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">"[0-9]+"</span></span></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"> in parentheses which will save the results in the first match and allow the matching string to be substituted into the match substitution text </span></span><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">"frame select %1"</span></span></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">. When we use our new regular expression command from the LLDB command line,  it will show us what command resulted from our regular expression substitution:<br /></span></span><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><br /></span></span></code></div><div><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">(lldb) f 12</span></span></code></div><div><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">frame select 12</span></span></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><span class="Apple-style-span" style="font-family: 'courier new';"><br /></span><br /></span></span></div><div><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">Any leading spaces that follow the regular expression command <span class="Apple-style-span" style="font-family: 'courier new';">"f"</span> will always be stripped prior to matching the regular expression, but there may be trailing spaces since we are processing the remaining raw command string that follows the initial </span></span><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">"f"</span></span></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"> command name. The regular expression is also just looking for any sequence of one or more digits. Our current regular expression will actually match:<br /></span></span><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><br /></span></span></code></div><div><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">(lldb) f 11 22 33<br />frame select 11</span></span></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><span class="Apple-style-span" style="font-family: 'courier new';"><br /></span><br /></span></span></div><div><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">Since this isn't desired, we should make the regular expression more complete by checking for the start of the line (</span></span><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">^</span></span></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">) and the end of the line (</span></span><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">$</span></span><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">) and also allow for zero or more spaces (</span></span><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">[[:space:]]*</span></span></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">) to come after the number. Our newer and safer regular expression command line looks like:</span></span></div><div><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><br /></span></span></code></div><div><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">(lldb) command regex f 's/^([0-9]+)[[:space:]]*$/frame select %1/'</span></span></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><br /><br /></span></span></div><div><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">Now we can type in a command as </span></span><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">"f 12 "</span></span></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"> (note the trailing spaces), and still get correct substitutions, while our previous example of </span></span><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">"f 11 22 33"</span></span></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"> will no longer match:<br /></span></span><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><br /></span></span></code></div><div><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">(lldb) f 11 22 33<br />error: Command contents '11 22 33' failed to match any regular expression in the 'f' regex command.</span></span></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><span class="Apple-style-span" style="font-family: 'courier new';"><br /></span><br /></span></span></div><div><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">Lets take this a bit further by also using the </span></span><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">f</span></span></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"> command to emulate GDB's </span></span><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">finish</span></span></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"> command when it is typed without any arguments. We will also modify this command to watch for a single "+" or "-" followed by a digit to signify a relative frame change using the frame select command with the --relative option:<br /></span></span><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><br /></span></span></code></div><div><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">(lldb) frame select --relative </span></span><integer><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><offset></offset></span></span></integer></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><br /><br /></span></span></div><div><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">Multiple regular expressions can be entered in on the command line, or using the multi-line mode when typing in a live LLDB debug session. Below the text in bold is user entered:<br /></span></span><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><br /></span></span></code></div><div><code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">(lldb) </span></span><b><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">commands regex f</span></span></b><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';"><br />Enter regular expressions in the form 's/</span></span><regex><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">/</span></span><subst><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">/' and terminate with an empty line:<br /></span></span><b><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">s/^([0-9]+)[[:space:]]*$/frame select %1/<br />s/^([+-][0-9]+)[[:space:]]*$/frame select --relative=%1/<br />s/^[[:space:]]*$/finish/</span></span></b><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><span class="Apple-style-span" style="font-family: 'courier new';"><br /></span><br /><span class="Apple-style-span" style="font-family: 'courier new';">(lldb) </span></span></span><b><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">f</span></span></b><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';"><br />finish<br />...<br />(lldb) </span></span><b><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">f -1</span></span></b><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';"><br />frame select --relative=-1<br />...<br />(lldb) </span></span><b><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">f +1</span></span></b><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';"><br />frame select --relative=+1<br />...<br />(lldb) </span></span><b><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">f 12</span></span></b><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';"><br />frame select 12<br /></span></span></subst></regex></code><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';"><br />I hope you can see the possilbities in how you can customize your command line experience in LLDB using these commands. You can add any regular expression commands to your </span></span><b><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'courier new';">~/.lldbinit</span><span class="Apple-style-span" style="font-family: 'lucida grande';"> </span></span></b><span class="Apple-style-span" style="font-size: small;"><span class="Apple-style-span" style="font-family: 'lucida grande';">file to always have your regular expression commands defined in your debug sessions.</span></span></div><div><span class="Apple-style-span" style="font-family: Times;"><br /></span></div>
