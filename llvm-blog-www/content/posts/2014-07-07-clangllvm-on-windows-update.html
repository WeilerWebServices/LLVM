---
author: Unknown
blogger_id: tag:blogger.com,1999:blog-6088150582281556517.post-4977604081068096525
blogger_orig_url: http://blog.llvm.org/2014/07/clangllvm-on-windows-update.html
date: "2014-07-07T20:34:00Z"
modified_time: "2014-07-07T20:34:41.875-07:00"
tags: ["Clang","Windows"]
title: Clang/LLVM on Windows Update
aliases:
 - /2014/07/clangllvm-on-windows-update.html
---

<div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">It’s time for an update on Clang’s support for building native Windows programs, compatible with Visual C++! &nbsp;We’ve been working hard over the last few months and have improved the toolchain in a variety of ways. &nbsp;All C++ features aside from debug info and exceptions should work well. &nbsp;This </span><a href="http://clang.llvm.org/docs/MSVCCompatibility.html" style="text-decoration: none;"><span style="background-color: transparent; color: #1155cc; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;">link</span></a><span style="background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> provide more specific details. &nbsp;In February we reached an exciting milestone that we can self-host Clang and LLVM using clang-cl (without fallback), and both projects &nbsp;pass all of their tests! &nbsp;Additionally both Chrome and Firefox now compile successfully with fallback! &nbsp;Here are some of the highlights of recent improvements:</span></div><b id="docs-internal-guid-2b2f973e-119b-7120-2d4c-138311c64483" style="font-weight: normal;"><br /></b><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Microsoft compatible record layout is done! &nbsp;It’s been thoroughly fuzz tested and supports all Microsoft specific components such as virtual base table pointers, </span><a href="http://msdn.microsoft.com/en-us/library/453x4xdd.aspx" style="text-decoration: none;"><span style="background-color: transparent; color: #1155cc; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;">vtordisps</span></a><span style="background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">, __declspec(align) and #pragma pack. &nbsp;This turned out to be a major effort due to subtle interactions between various features. &nbsp;For example, __declspec(align) and #pragma pack behave in an analogous manner to the gcc variants, but interact with each other in a different manner. Each version of Visual Studio changes the ABI slightly. &nbsp;As of today clang-cl is layout compatible with VS2013.</span></div><b style="font-weight: normal;"><br /></b><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Clang now supports all of the calling conventions used up to VS2012. &nbsp;VS2013 added some new ones that we haven’t implemented yet. &nbsp;One of the other major compatibility challenges we overcame was passing C++ objects by value on 32-bit x86. &nbsp;Prior to this effort, LLVM modeled all outgoing arguments as SSA values, making it impossible to take the address of an argument to a call. &nbsp;It turns out that on Windows C++ objects passed by value are constructed directly into the argument memory used for the function call. &nbsp;Achieving 100% compatibility in this area required making fundamental changes to LLVM IR to allow us to compute this address.</span></div><b style="font-weight: normal;"><br /></b><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Most recently support for run time type information (RTTI) was completed. &nbsp;With RTTI support, a larger set of programs and libraries (for example </span><a href="http://site.icu-project.org/" style="text-decoration: none;"><span style="background-color: transparent; color: #1155cc; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;">ICU</span></a><span style="background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">) compile without fallback and dynamic_cast and typeid both work. &nbsp;RTTI support also brings along support for std::function. &nbsp;We also recently added support for lambdas so you can enjoy all of the C++11 functional goodness!</span></div><br /><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">We invite you to </span><a href="http://llvm.org/builds/" style="text-decoration: none;"><span style="background-color: transparent; color: #1155cc; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;">try it out for yourself</span></a><span style="background-color: transparent; color: black; font-family: Arial; font-size: 15px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> and, as always, we encourage everyone to file bugs!</span></div>
